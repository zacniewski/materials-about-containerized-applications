version: "3.8"

# Prosty przykład: jedna sieć użytkownika, web wystawiony na hosta, baza tylko wewnątrz sieci.

services:
  web:
    image: nginxdemos/hello:latest
    container_name: networks_simple_web
    ports:
      - "8080:80"   # tylko web jest wystawiony na hosta
    networks:
      - appnet
    depends_on:
      - db

  db:
    image: postgres:16-alpine
    container_name: networks_simple_db
    environment:
      POSTGRES_USER: app
      POSTGRES_PASSWORD: example # Uwaga: do produkcji użyj sekretów!
      POSTGRES_DB: appdb
    networks:
      - appnet
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U app -d appdb"]
      interval: 5s
      timeout: 3s
      retries: 10

networks:
  appnet:
    driver: bridge
    # user-defined bridge zapewnia DNS po nazwach usług (web łączy się do 'db' po nazwie)
